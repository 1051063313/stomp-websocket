/*! Stomp Over WebSocket v2.0.0 http://www.jmesnil.net/stomp-websocket/doc/ | Apache License V2.0 */
(function(){var e,t,n,r,i={}.hasOwnProperty;e={LF:"\n",NULL:"\0"},n=function(){function t(e,t,n){this.command=e,this.headers=t!=null?t:[],this.body=n!=null?n:""}return t.prototype.toString=function(){var t,n,r,s;t=[this.command],s=this.headers;for(n in s){if(!i.call(s,n))continue;r=s[n],t.push(""+n+":"+r)}return t.push(e.LF+this.body),t.join(e.LF)},t._unmarshallSingle=function(n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;o=n.search(RegExp(""+e.LF+e.LF)),u=n.substring(0,o).split(e.LF),s=u.shift(),a={},h=function(e){return e.replace(/^\s+|\s+$/g,"")},c=l=null;for(f=p=0,v=u.length;0<=v?p<v:p>v;f=0<=v?++p:--p)c=u[f],l=c.indexOf(":"),a[h(c.substring(0,l))]=h(c.substring(l+1));r="",i=null;for(f=d=m=o+2,g=n.length;m<=g?d<g:d>g;f=m<=g?++d:--d){i=n.charAt(f);if(i===e.NULL)break;r+=i}return new t(s,a,r)},t.unmarshall=function(n){var r;return function(){var i,s,o,u;o=n.split(RegExp(""+e.NULL+e.LF+"*")),u=[];for(i=0,s=o.length;i<s;i++)r=o[i],(r!=null?r.length:void 0)>0&&u.push(t._unmarshallSingle(r));return u}()},t.marshall=function(n,r,i){var s;return s=new t(n,r,i),s.toString()+e.NULL},t}(),r={libVersion:"2.0.0",VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,n){var i,s;return n==null&&(n="v10.stomp,v11.stomp"),i=r.WebSocketClass||WebSocket,s=new i(e,n),new t(s)},over:function(e){return new t(e)}},t=function(){function t(e){this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.subscriptions={}}return t.prototype._transmit=function(e,t,r){var i;return i=n.marshall(e,t,r),typeof this.debug=="function"&&this.debug(">>> "+i),this.ws.send(i)},t.prototype._setupHeartbeat=function(t){var n,i,s,o,u,a,f=this;if((u=t.version)===r.VERSIONS.V1_1||u===r.VERSIONS.V1_2){a=function(){var e,n,r,i;r=t["heart-beat"].split(","),i=[];for(e=0,n=r.length;e<n;e++)o=r[e],i.push(parseInt(o));return i}(),i=a[0],n=a[1],this.heartbeat.outgoing!==0&&n!==0&&(s=Math.max(this.heartbeat.outgoing,n),this.debug("send PING every "+s+"ms"),this.pinger=typeof window!="undefined"&&window!==null?window.setInterval(function(){return f.ws.send(e.LF),typeof f.debug=="function"?f.debug(">> PING"):void 0},s):void 0);if(this.heartbeat.incoming!==0&&i!==0)return s=Math.max(this.heartbeat.incoming,i),this.debug("check PONG every "+s+"ms"),this.ponger=typeof window!="undefined"&&window!==null?window.setInterval(function(){var e;e=Date.now()-f.serverActivity;if(e>s*2)return f._cleanUp()},s):void 0}},t.prototype.connect=function(t,i,s,o,u,a){var f=this;return this.connectCallback=s,a==null&&(a="10000,10000"),typeof this.debug=="function"&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(t){var r,i,u,a,l,c,h,p,d;r=function(){var e,n;if(typeof ArrayBuffer!="undefined"&&t.data instanceof ArrayBuffer){l=new Uint8Array(t.data),typeof this.debug=="function"&&this.debug("--- got data length: "+l.length),r="";for(e=0,n=l.length;e<n;e++)u=l[e],r+=String.fromCharCode(u);return r}return t.data}.call(f),f.serverActivity=Date.now();if(r===e.LF){typeof f.debug=="function"&&f.debug("<<< PONG");return}typeof f.debug=="function"&&f.debug("<<< "+r),p=n.unmarshall(r),d=[];for(c=0,h=p.length;c<h;c++)i=p[c],i.command==="CONNECTED"&&s?(f.connected=!0,f._setupHeartbeat(i.headers),d.push(s(i))):i.command==="MESSAGE"?(a=f.subscriptions[i.headers.subscription],d.push(typeof a=="function"?a(i):void 0)):i.command==="RECEIPT"?d.push(typeof f.onreceipt=="function"?f.onreceipt(i):void 0):i.command==="ERROR"?d.push(typeof o=="function"?o(i):void 0):d.push(typeof f.debug=="function"?f.debug("Unhandled frame: "+JSON.stringify(i)):void 0);return d},this.ws.onclose=function(){var e;return e="Whoops! Lost connection to "+f.ws.url,typeof f.debug=="function"&&f.debug(e),typeof o=="function"?o(e):void 0},this.ws.onopen=function(){var e,n,s,o;return typeof f.debug=="function"&&f.debug("Web Socket Opened..."),s={login:t,passcode:i},u&&(s.host=u),s["heart-beat"]=a,o=a.split(","),e=o[0],n=o[1],f.heartbeat.outgoing=parseInt(e),f.heartbeat.incoming=parseInt(n),s["accept-version"]=r.VERSIONS.supportedVersions(),f._transmit("CONNECT",s)}},t.prototype.disconnect=function(e){return this._transmit("DISCONNECT"),this.ws.onclose=null,this._cleanUp(),typeof e=="function"?e():void 0},t.prototype._cleanUp=function(){this.ws.close(),this.connected=!1,this.pinger&&typeof window!="undefined"&&window!==null&&window.clearInterval(this.pinger);if(this.ponger)return typeof window!="undefined"&&window!==null?window.clearInterval(this.ponger):void 0},t.prototype.send=function(e,t,n){return t==null&&(t={}),n==null&&(n=""),t.destination=e,this._transmit("SEND",t,n)},t.prototype.subscribe=function(e,t,n){var r;return n==null&&(n={}),typeof n.id=="undefined"||n.id.length===0?(r="sub-"+this.counter++,n.id=r):r=n.id,n.destination=e,this.subscriptions[r]=t,this._transmit("SUBSCRIBE",n),r},t.prototype.unsubscribe=function(e,t){return t==null&&(t={}),t.id=e,delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",t)},t.prototype.begin=function(e,t){return t==null&&(t={}),t.transaction=e,this._transmit("BEGIN",t)},t.prototype.commit=function(e,t){return t==null&&(t={}),t.transaction=e,this._transmit("COMMIT",t)},t.prototype.abort=function(e,t){return t==null&&(t={}),t.transaction=e,this._transmit("ABORT",t)},t.prototype.ack=function(e,t){return t==null&&(t={}),t["message-id"]=e,this._transmit("ACK",t)},t}(),typeof window!="undefined"&&window!==null?window.Stomp=r:(r.Frame=n,exports.Stomp=r,r.WebSocketClass=require("./test/server.mock.js").StompServerMock)}).call(this);