// Generated by CoffeeScript 1.6.3
/*
   Stomp Over WebSocket http://www.jmesnil.net/stomp-websocket/doc/ | Apache License V2.0

   Copyright (C) 2010-2013 [Jeff Mesnil](http://jmesnil.net/)
   Copyright (C) 2012 [FuseSource, Inc.](http://fusesource.com)
*/
!function(){var e,t,n,i,o={}.hasOwnProperty,r=[].slice;e={LF:"\n",NULL:"\0"};n=function(){var t;function n(e,t,n){this.command=e;this.headers=t!=null?t:{};this.body=n!=null?n:""}n.prototype.toString=function(){var t,n,i,r;t=[this.command];r=this.headers;for(n in r){if(!o.call(r,n))continue;i=r[n];t.push(""+n+":"+i)}if(this.body){t.push("content-length:"+(""+this.body).length)}t.push(e.LF+this.body);return t.join(e.LF)};t=function(t){var i,o,r,s,u,c,a,f,l,d,h,p,g,b,v,w,y;s=t.search(RegExp(""+e.LF+e.LF));u=t.substring(0,s).split(e.LF);r=u.shift();c={};p=function(e){return e.replace(/^\s+|\s+$/g,"")};w=u.reverse();for(g=0,v=w.length;g<v;g++){d=w[g];f=d.indexOf(":");c[p(d.substring(0,f))]=p(d.substring(f+1))}i="";h=s+2;if(c["content-length"]){l=parseInt(c["content-length"]);i=(""+t).substring(h,h+l)}else{o=null;for(a=b=h,y=t.length;h<=y?b<y:b>y;a=h<=y?++b:--b){o=t.charAt(a);if(o===e.NULL){break}i+=o}}return new n(r,c,i)};n.unmarshall=function(n){var i;return function(){var o,r,s,u;s=n.split(RegExp(""+e.NULL+e.LF+"*"));u=[];for(o=0,r=s.length;o<r;o++){i=s[o];if((i!=null?i.length:void 0)>0){u.push(t(i))}}return u}()};n.marshall=function(t,i,o){var r;r=new n(t,i,o);return r.toString()+e.NULL};return n}();t=function(){var t,o,s,u;function c(e){this.ws=e;this.ws.binaryType="arraybuffer";this.counter=0;this.connected=false;this.heartbeat={outgoing:1e4,incoming:1e4};this.maxWebSocketFrameSize=16*1024;this.subscriptions={}}c.prototype.debug=function(e){var t;return typeof window!=="undefined"&&window!==null?(t=window.console)!=null?t.log(e):void 0:void 0};o=function(){return Date.now||(new Date).valueOf};u=function(e,t,i){var o;o=n.marshall(e,t,i);if(typeof this.debug==="function"){this.debug(">>> "+o)}while(true){if(o.length>this.maxWebSocketFrameSize){this.ws.send(o.substring(0,this.maxWebSocketFrameSize));o=o.substring(this.maxWebSocketFrameSize);if(typeof this.debug==="function"){this.debug("remaining = "+o.length)}}else{return this.ws.send(o)}}};s=function(t){var n,r,s,u,c,a,f=this;if((c=t.version)!==i.VERSIONS.V1_1&&c!==i.VERSIONS.V1_2){return}a=function(){var e,n,i,o;i=t["heart-beat"].split(",");o=[];for(e=0,n=i.length;e<n;e++){u=i[e];o.push(parseInt(u))}return o}(),r=a[0],n=a[1];if(!(this.heartbeat.outgoing===0||n===0)){s=Math.max(this.heartbeat.outgoing,n);if(typeof this.debug==="function"){this.debug("send PING every "+s+"ms")}this.pinger=typeof window!=="undefined"&&window!==null?window.setInterval(function(){f.ws.send(e.LF);return typeof f.debug==="function"?f.debug(">>> PING"):void 0},s):void 0}if(!(this.heartbeat.incoming===0||r===0)){s=Math.max(this.heartbeat.incoming,r);if(typeof this.debug==="function"){this.debug("check PONG every "+s+"ms")}return this.ponger=typeof window!=="undefined"&&window!==null?window.setInterval(function(){var e;e=o()-f.serverActivity;if(e>s*2){if(typeof f.debug==="function"){f.debug("did not receive server activity for the last "+e+"ms")}return f.ws.close()}},s):void 0}};c.prototype._parseConnect=function(){var e,t,n,i;e=1<=arguments.length?r.call(arguments,0):[];i={};switch(e.length){case 2:i=e[0],t=e[1];break;case 3:if(e[1]instanceof Function){i=e[0],t=e[1],n=e[2]}else{i.login=e[0],i.passcode=e[1],t=e[2]}break;case 4:i.login=e[0],i.passcode=e[1],t=e[2],n=e[3];break;default:i.login=e[0],i.passcode=e[1],t=e[2],n=e[3],i.vhost=e[4]}return[i,t,n]};c.prototype.connect=function(){var c,a,f,l,d=this;c=1<=arguments.length?r.call(arguments,0):[];l=this._parseConnect.apply(this,c);f=l[0],this.connectCallback=l[1],a=l[2];if(typeof this.debug==="function"){this.debug("Opening Web Socket...")}this.ws.onmessage=function(t){var i,r,u,c,f,l,h,p,g;u=typeof ArrayBuffer!=="undefined"&&t.data instanceof ArrayBuffer?(i=new Uint8Array(t.data),typeof d.debug==="function"?d.debug("--- got data length: "+i.length):void 0,function(){var e,t,n;n=[];for(e=0,t=i.length;e<t;e++){r=i[e];n.push(String.fromCharCode(r))}return n}().join("")):t.data;d.serverActivity=o();if(u===e.LF){if(typeof d.debug==="function"){d.debug("<<< PONG")}return}if(typeof d.debug==="function"){d.debug("<<< "+u)}p=n.unmarshall(u);g=[];for(l=0,h=p.length;l<h;l++){c=p[l];switch(c.command){case"CONNECTED":if(typeof d.debug==="function"){d.debug("connected to server "+c.headers.server)}d.connected=true;s.call(d,c.headers);g.push(typeof d.connectCallback==="function"?d.connectCallback(c):void 0);break;case"MESSAGE":f=d.subscriptions[c.headers.subscription]||d.onreceive;if(f){g.push(f(c))}else{g.push(typeof d.debug==="function"?d.debug("Unhandled received MESSAGE: "+c):void 0)}break;case"RECEIPT":g.push(typeof d.onreceipt==="function"?d.onreceipt(c):void 0);break;case"ERROR":g.push(typeof a==="function"?a(c):void 0);break;default:g.push(typeof d.debug==="function"?d.debug("Unhandled frame: "+c):void 0)}}return g};this.ws.onclose=function(){var e;e="Whoops! Lost connection to "+d.ws.url;if(typeof d.debug==="function"){d.debug(e)}t.call(d);return typeof a==="function"?a(e):void 0};return this.ws.onopen=function(){if(typeof d.debug==="function"){d.debug("Web Socket Opened...")}f["accept-version"]=i.VERSIONS.supportedVersions();f["heart-beat"]=[d.heartbeat.outgoing,d.heartbeat.incoming].join(",");return u.call(d,"CONNECT",f)}};c.prototype.disconnect=function(e){u.call(this,"DISCONNECT");this.ws.onclose=null;this.ws.close();t.call(this);return typeof e==="function"?e():void 0};t=function(){this.connected=false;if(this.pinger){if(typeof window!=="undefined"&&window!==null){window.clearInterval(this.pinger)}}if(this.ponger){return typeof window!=="undefined"&&window!==null?window.clearInterval(this.ponger):void 0}};c.prototype.send=function(e,t,n){if(t==null){t={}}if(n==null){n=""}t.destination=e;return u.call(this,"SEND",t,n)};c.prototype.subscribe=function(e,t,n){if(n==null){n={}}if(!n.id){n.id="sub-"+this.counter++}n.destination=e;this.subscriptions[n.id]=t;u.call(this,"SUBSCRIBE",n);return n.id};c.prototype.unsubscribe=function(e){delete this.subscriptions[e];return u.call(this,"UNSUBSCRIBE",{id:e})};c.prototype.begin=function(e){return u.call(this,"BEGIN",{transaction:e})};c.prototype.commit=function(e){return u.call(this,"COMMIT",{transaction:e})};c.prototype.abort=function(e){return u.call(this,"ABORT",{transaction:e})};c.prototype.ack=function(e,t,n){if(n==null){n={}}n["message-id"]=e;n.subscription=t;return u.call(this,"ACK",n)};c.prototype.nack=function(e,t,n){if(n==null){n={}}n["message-id"]=e;n.subscription=t;return u.call(this,"NACK",n)};return c}();i={libVersion:"2.0.0-next",VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,n){var o,r;if(n==null){n=["v10.stomp","v11.stomp"]}o=i.WebSocketClass||WebSocket;r=new o(e,n);return new t(r)},over:function(e){return new t(e)},Frame:n};if(typeof window!=="undefined"&&window!==null){window.Stomp=i}else if(typeof exports!=="undefined"&&exports!==null){exports.Stomp=i;i.WebSocketClass=require("./test/server.mock.js").StompServerMock}else{self.Stomp=i}}.call(this);