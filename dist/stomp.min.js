// Generated by CoffeeScript 1.6.3
/*
   Stomp Over WebSocket http://www.jmesnil.net/stomp-websocket/doc/ | Apache License V2.0
*/
!function(){var t,n,e,i,o={}.hasOwnProperty;t={LF:"\n",NULL:"\0"};e=function(){function n(t,n,e){this.command=t;this.headers=n!=null?n:{};this.body=e!=null?e:""}n.prototype.toString=function(){var n,e,i,r;n=[this.command];r=this.headers;for(e in r){if(!o.call(r,e))continue;i=r[e];n.push(""+e+":"+i)}if(this.body){n.push("content-length:"+(""+this.body).length)}n.push(t.LF+this.body);return n.join(t.LF)};n._unmarshallSingle=function(e){var i,o,r,s,u,a,f,c,d,h,p,l,g,b,w,y;s=e.search(RegExp(""+t.LF+t.LF));u=e.substring(0,s).split(t.LF);r=u.shift();a={};l=function(t){return t.replace(/^\s+|\s+$/g,"")};h=c=null;for(f=g=0,w=u.length;0<=w?g<w:g>w;f=0<=w?++g:--g){h=u[f];c=h.indexOf(":");a[l(h.substring(0,c))]=l(h.substring(c+1))}i="";p=s+2;if(a["content-length"]){d=parseInt(a["content-length"]);i=(""+e).substring(p,p+d)}else{o=null;for(f=b=p,y=e.length;p<=y?b<y:b>y;f=p<=y?++b:--b){o=e.charAt(f);if(o===t.NULL){break}i+=o}}return new n(r,a,i)};n.unmarshall=function(e){var i;return function(){var o,r,s,u;s=e.split(RegExp(""+t.NULL+t.LF+"*"));u=[];for(o=0,r=s.length;o<r;o++){i=s[o];if((i!=null?i.length:void 0)>0){u.push(n._unmarshallSingle(i))}}return u}()};n.marshall=function(e,i,o){var r;r=new n(e,i,o);return r.toString()+t.NULL};return n}();n=function(){function n(t){this.ws=t;this.ws.binaryType="arraybuffer";this.counter=0;this.connected=false;this.heartbeat={outgoing:1e4,incoming:1e4};this.maxWebSocketFrameSize=16*1024;this.subscriptions={}}n.prototype.debug=function(t){var n;return typeof window!=="undefined"&&window!==null?(n=window.console)!=null?n.log(t):void 0:void 0};n.prototype._transmit=function(t,n,i){var o;o=e.marshall(t,n,i);if(typeof this.debug==="function"){this.debug(">>> "+o)}while(true){if(o.length>this.maxWebSocketFrameSize){this.ws.send(o.substring(0,this.maxWebSocketFrameSize));o=o.substring(this.maxWebSocketFrameSize);if(typeof this.debug==="function"){this.debug("remaining = "+o.length)}}else{return this.ws.send(o)}}};n.prototype._setupHeartbeat=function(n){var e,o,r,s,u,a,f=this;if((u=n.version)!==i.VERSIONS.V1_1&&u!==i.VERSIONS.V1_2){return}a=function(){var t,e,i,o;i=n["heart-beat"].split(",");o=[];for(t=0,e=i.length;t<e;t++){s=i[t];o.push(parseInt(s))}return o}(),o=a[0],e=a[1];if(!(this.heartbeat.outgoing===0||e===0)){r=Math.max(this.heartbeat.outgoing,e);if(typeof this.debug==="function"){this.debug("send PING every "+r+"ms")}this.pinger=typeof window!=="undefined"&&window!==null?window.setInterval(function(){f.ws.send(t.LF);return typeof f.debug==="function"?f.debug(">>> PING"):void 0},r):void 0}if(!(this.heartbeat.incoming===0||o===0)){r=Math.max(this.heartbeat.incoming,o);if(typeof this.debug==="function"){this.debug("check PONG every "+r+"ms")}return this.ponger=typeof window!=="undefined"&&window!==null?window.setInterval(function(){var t;t=Date.now()-f.serverActivity;if(t>r*2){if(typeof f.debug==="function"){f.debug("did not receive server activity for the last "+t+"ms")}return f.ws.close()}},r):void 0}};n.prototype.connect=function(n,o,r,s,u){var a=this;this.connectCallback=r;if(typeof this.debug==="function"){this.debug("Opening Web Socket...")}this.ws.onmessage=function(n){var i,o,r,u,f,c,d,h,p;r=typeof ArrayBuffer!=="undefined"&&n.data instanceof ArrayBuffer?(i=new Uint8Array(n.data),typeof a.debug==="function"?a.debug("--- got data length: "+i.length):void 0,function(){var t,n,e;e=[];for(t=0,n=i.length;t<n;t++){o=i[t];e.push(String.fromCharCode(o))}return e}().join("")):n.data;a.serverActivity=Date.now();if(r===t.LF){if(typeof a.debug==="function"){a.debug("<<< PONG")}return}if(typeof a.debug==="function"){a.debug("<<< "+r)}h=e.unmarshall(r);p=[];for(c=0,d=h.length;c<d;c++){u=h[c];switch(u.command){case"CONNECTED":if(typeof a.debug==="function"){a.debug("connected to server "+u.headers.server)}a.connected=true;a._setupHeartbeat(u.headers);p.push(typeof a.connectCallback==="function"?a.connectCallback(u):void 0);break;case"MESSAGE":f=a.subscriptions[u.headers.subscription];p.push(typeof f==="function"?f(u):void 0);break;case"RECEIPT":p.push(typeof a.onreceipt==="function"?a.onreceipt(u):void 0);break;case"ERROR":p.push(typeof s==="function"?s(u):void 0);break;default:p.push(typeof a.debug==="function"?a.debug("Unhandled frame: "+u):void 0)}}return p};this.ws.onclose=function(){var t;t="Whoops! Lost connection to "+a.ws.url;if(typeof a.debug==="function"){a.debug(t)}a._cleanUp();return typeof s==="function"?s(t):void 0};return this.ws.onopen=function(){var t;if(typeof a.debug==="function"){a.debug("Web Socket Opened...")}t={"accept-version":i.VERSIONS.supportedVersions(),"heart-beat":[a.heartbeat.outgoing,a.heartbeat.incoming].join(",")};if(u){t.host=u}if(n){t.login=n}if(o){t.passcode=o}return a._transmit("CONNECT",t)}};n.prototype.disconnect=function(t){this._transmit("DISCONNECT");this.ws.onclose=null;this.ws.close();this._cleanUp();return typeof t==="function"?t():void 0};n.prototype._cleanUp=function(){this.connected=false;if(this.pinger){if(typeof window!=="undefined"&&window!==null){window.clearInterval(this.pinger)}}if(this.ponger){return typeof window!=="undefined"&&window!==null?window.clearInterval(this.ponger):void 0}};n.prototype.send=function(t,n,e){if(n==null){n={}}if(e==null){e=""}n.destination=t;return this._transmit("SEND",n,e)};n.prototype.subscribe=function(t,n,e){if(e==null){e={}}if(!e.id){e.id="sub-"+this.counter++}e.destination=t;this.subscriptions[e.id]=n;this._transmit("SUBSCRIBE",e);return e.id};n.prototype.unsubscribe=function(t){delete this.subscriptions[t];return this._transmit("UNSUBSCRIBE",{id:t})};n.prototype.begin=function(t){return this._transmit("BEGIN",{transaction:t})};n.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})};n.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})};n.prototype.ack=function(t,n,e){if(e==null){e={}}e["message-id"]=t;e.subscription=n;return this._transmit("ACK",e)};n.prototype.nack=function(t,n,e){if(e==null){e={}}e["message-id"]=t;e.subscription=n;return this._transmit("NACK",e)};return n}();i={libVersion:"2.0.0-next",VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(t,e){var o,r;if(e==null){e=["v10.stomp","v11.stomp"]}o=i.WebSocketClass||WebSocket;r=new o(t,e);return new n(r)},over:function(t){return new n(t)},Frame:e};if(typeof window!=="undefined"&&window!==null){window.Stomp=i}else if(typeof exports!=="undefined"&&exports!==null){exports.Stomp=i;i.WebSocketClass=require("./test/server.mock.js").StompServerMock}else{self.Stomp=i}}.call(this);