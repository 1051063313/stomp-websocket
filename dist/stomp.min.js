/*! Stomp Over WebSocket v0.1.0 http://www.jmesnil.net/stomp-websocket/doc/ | Apache License V2.0 */
(function(){var e,t,n={}.hasOwnProperty;t={HEADERS:{HOST:"host",ACCEPT_VERSION:"accept-version",VERSION:"version",HEART_BEAT:"heart-beat"},VERSIONS:{VERSION_1_0:"1.0",VERSION_1_1:"1.1",VERSION_1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},frame:function(e,t,r){return t==null&&(t=[]),r==null&&(r=""),{command:e,headers:t,body:r,id:t.id,receipt:t.receipt,transaction:t.transaction,destination:t.destination,subscription:t.subscription,error:null,toString:function(){var i,s,o;i=[e];for(s in t){if(!n.call(t,s))continue;o=t[s],i.push(""+s+":"+o)}return i.push("\n"+r),i.join("\n")}}},unmarshal:function(e){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;s=e.search(/\n\n/),o=e.substring(0,s).split("\n"),i=o.shift(),u={},n="",c=function(e){return e.replace(/^\s+/g,"").replace(/\s+$/g,"")},l=f=null;for(a=h=0,d=o.length;0<=d?h<d:h>d;a=0<=d?++h:--h)l=o[a],f=l.indexOf(":"),u[c(l.substring(0,f))]=c(l.substring(f+1));r=null;for(a=p=v=s+2,m=e.length;v<=m?p<m:p>m;a=v<=m?++p:--p){r=e.charAt(a);if(r==="\0")break;n+=r}return t.frame(i,u,n)},unmarshal_multi:function(e){var n,r;return r=function(){var r,i,s,o;s=e.split(/\x00\n*/),o=[];for(r=0,i=s.length;r<i;r++)n=s[r],n&&n.length>0&&o.push(t.unmarshal(n));return o}(),r},marshal:function(e,n,r){return t.frame(e,n,r).toString()+"\0"},client:function(n,r){var i,s;return r==null&&(r="v10.stomp,v11.stomp"),i=t.WebSocketClass||WebSocket,s=new i(n,r),new e(s)},over:function(t){return new e(t)}},e=function(){function e(e){this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:0},this.subscriptions={}}return e.prototype._transmit=function(e,n,r){var i;return i=t.marshal(e,n,r),typeof this.debug=="function"&&this.debug(">>> "+i),this.ws.send(i)},e.prototype._setupHeartbeat=function(e){var n,r,i,s,o,u,a;o=e[t.HEADERS.VERSION];if(o===t.VERSIONS.VERSION_1_1||o===t.VERSIONS.VERSION_1_2){a=e[t.HEADERS.HEART_BEAT].split(","),s=a[0],i=a[1],i=parseInt(i);if(this.heartbeat.outgoing!==0&&i!==0)return u=Math.max(this.heartbeat.outgoing,i),typeof this.debug=="function"&&this.debug("send ping every "+u+"ms"),r=this,n=function(){return r.ws.send("\n")},this.pinger=typeof window!="undefined"&&window!==null?window.setInterval(n,u):void 0}},e.prototype.connect=function(e,n,r,i,s,o){var u=this;return o==null&&(o="10000,0"),typeof this.debug=="function"&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(e){var n,s,o,a,f,l,c,h,p;n=function(){var t,r;if(typeof ArrayBuffer!="undefined"&&e.data instanceof ArrayBuffer){f=new Uint8Array(e.data),typeof this.debug=="function"&&this.debug("--- got data length: "+f.length),n="";for(t=0,r=f.length;t<r;t++)o=f[t],n+=String.fromCharCode(o);return n}return e.data}.call(u);if(n==="\n")return;typeof u.debug=="function"&&u.debug("<<< "+n),h=t.unmarshal_multi(n),p=[];for(l=0,c=h.length;l<c;l++)s=h[l],s.command==="CONNECTED"&&r?(u.connected=!0,u._setupHeartbeat(s.headers),p.push(r(s))):s.command==="MESSAGE"?(a=u.subscriptions[s.headers.subscription],p.push(typeof a=="function"?a(s):void 0)):s.command==="ERROR"?p.push(typeof i=="function"?i(s):void 0):p.push(typeof u.debug=="function"?u.debug("Unhandled frame: "+JSON.stringify(s)):void 0);return p},this.ws.onclose=function(){var e;return e="Whoops! Lost connection to "+u.url,typeof u.debug=="function"&&u.debug(e),typeof i=="function"?i(e):void 0},this.ws.onopen=function(){var r,i,a,f;return typeof u.debug=="function"&&u.debug("Web Socket Opened..."),a={login:e,passcode:n},s&&(a[t.HEADERS.HOST]=s),a[t.HEADERS.HEART_BEAT]=o,f=o.split(","),r=f[0],i=f[1],u.heartbeat.outgoing=parseInt(r),u.heartbeat.incoming=parseInt(i),a[t.HEADERS.ACCEPT_VERSION]=t.VERSIONS.supportedVersions(),u._transmit("CONNECT",a)},this.connectCallback=r},e.prototype.disconnect=function(e){return this._transmit("DISCONNECT"),this.ws.close(),this.connected=!1,this.pinger&&typeof window!="undefined"&&window!==null&&window.clearInterval(this.pinger),typeof e=="function"?e():void 0},e.prototype.send=function(e,t,n){return t==null&&(t={}),n==null&&(n=""),t.destination=e,this._transmit("SEND",t,n)},e.prototype.subscribe=function(e,t,n){var r;return n==null&&(n={}),typeof n.id=="undefined"||n.id.length===0?(r="sub-"+this.counter++,n.id=r):r=n.id,n.destination=e,this.subscriptions[r]=t,this._transmit("SUBSCRIBE",n),r},e.prototype.unsubscribe=function(e,t){return t==null&&(t={}),t.id=e,delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",t)},e.prototype.begin=function(e,t){return t==null&&(t={}),t.transaction=e,this._transmit("BEGIN",t)},e.prototype.commit=function(e,t){return t==null&&(t={}),t.transaction=e,this._transmit("COMMIT",t)},e.prototype.abort=function(e,t){return t==null&&(t={}),t.transaction=e,this._transmit("ABORT",t)},e.prototype.ack=function(e,t){return t==null&&(t={}),t["message-id"]=e,this._transmit("ACK",t)},e}(),typeof window!="undefined"&&window!==null?window.Stomp=t:(exports.Stomp=t,t.WebSocketClass=require("./test/server.mock.js").StompServerMock)}).call(this);