/*! Stomp Over WebSocket v2.0.0 http://www.jmesnil.net/stomp-websocket/doc/ | Apache License V2.0 */
(function(){var e,t,n,r={}.hasOwnProperty;e={LF:"\n",NULL:"\0"},n={libVersion:"2.0.0",HEADERS:{HOST:"host",ACCEPT_VERSION:"accept-version",VERSION:"version",HEART_BEAT:"heart-beat"},VERSIONS:{VERSION_1_0:"1.0",VERSION_1_1:"1.1",VERSION_1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},frame:function(t,n,i){return n==null&&(n=[]),i==null&&(i=""),{command:t,headers:n,body:i,toString:function(){var s,o,u;s=[t];for(o in n){if(!r.call(n,o))continue;u=n[o],s.push(""+o+":"+u)}return s.push(e.LF+i),s.join(e.LF)}}},unmarshall:function(t){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;o=t.search(RegExp(""+e.LF+e.LF)),u=t.substring(0,o).split(e.LF),s=u.shift(),a={},r="",h=function(e){return e.replace(/^\s+|\s+$/g,"")},c=l=null;for(f=p=0,v=u.length;0<=v?p<v:p>v;f=0<=v?++p:--p)c=u[f],l=c.indexOf(":"),a[h(c.substring(0,l))]=h(c.substring(l+1));i=null;for(f=d=m=o+2,g=t.length;m<=g?d<g:d>g;f=m<=g?++d:--d){i=t.charAt(f);if(i===e.NULL)break;r+=i}return n.frame(s,a,r)},unmarshall_multi:function(t){var r,i;return i=function(){var i,s,o,u;o=t.split(RegExp(""+e.NULL+e.LF+"*")),u=[];for(i=0,s=o.length;i<s;i++)r=o[i],(r!=null?r.length:void 0)>0&&u.push(n.unmarshall(r));return u}(),i},marshall:function(t,r,i){return n.frame(t,r,i).toString()+e.NULL},client:function(e,r){var i,s;return r==null&&(r="v10.stomp,v11.stomp"),i=n.WebSocketClass||WebSocket,s=new i(e,r),new t(s)},over:function(e){return new t(e)}},t=function(){function t(e){this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:0},this.subscriptions={}}return t.prototype._transmit=function(e,t,r){var i;return i=n.marshall(e,t,r),typeof this.debug=="function"&&this.debug(">>> "+i),this.ws.send(i)},t.prototype._setupHeartbeat=function(t){var r,i,s,o,u,a,f=this;o=t[n.HEADERS.VERSION];if(o===n.VERSIONS.VERSION_1_1||o===n.VERSIONS.VERSION_1_2){a=t[n.HEADERS.HEART_BEAT].split(","),s=a[0],i=a[1],i=parseInt(i);if(this.heartbeat.outgoing!==0&&i!==0)return u=Math.max(this.heartbeat.outgoing,i),typeof this.debug=="function"&&this.debug("send ping every "+u+"ms"),r=function(){return f.ws.send(e.LF)},this.pinger=typeof window!="undefined"&&window!==null?window.setInterval(r,u):void 0}},t.prototype.connect=function(t,r,i,s,o,u){var a=this;return u==null&&(u="10000,0"),typeof this.debug=="function"&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(t){var r,o,u,f,l,c,h,p,d;r=function(){var e,n;if(typeof ArrayBuffer!="undefined"&&t.data instanceof ArrayBuffer){l=new Uint8Array(t.data),typeof this.debug=="function"&&this.debug("--- got data length: "+l.length),r="";for(e=0,n=l.length;e<n;e++)u=l[e],r+=String.fromCharCode(u);return r}return t.data}.call(a);if(r===e.LF)return;typeof a.debug=="function"&&a.debug("<<< "+r),p=n.unmarshall_multi(r),d=[];for(c=0,h=p.length;c<h;c++)o=p[c],o.command==="CONNECTED"&&i?(a.connected=!0,a._setupHeartbeat(o.headers),d.push(i(o))):o.command==="MESSAGE"?(f=a.subscriptions[o.headers.subscription],d.push(typeof f=="function"?f(o):void 0)):o.command==="RECEIPT"?d.push(typeof a.onreceipt=="function"?a.onreceipt(o):void 0):o.command==="ERROR"?d.push(typeof s=="function"?s(o):void 0):d.push(typeof a.debug=="function"?a.debug("Unhandled frame: "+JSON.stringify(o)):void 0);return d},this.ws.onclose=function(){var e;return e="Whoops! Lost connection to "+a.url,typeof a.debug=="function"&&a.debug(e),typeof s=="function"?s(e):void 0},this.ws.onopen=function(){var e,i,s,f;return typeof a.debug=="function"&&a.debug("Web Socket Opened..."),s={login:t,passcode:r},o&&(s[n.HEADERS.HOST]=o),s[n.HEADERS.HEART_BEAT]=u,f=u.split(","),e=f[0],i=f[1],a.heartbeat.outgoing=parseInt(e),a.heartbeat.incoming=parseInt(i),s[n.HEADERS.ACCEPT_VERSION]=n.VERSIONS.supportedVersions(),a._transmit("CONNECT",s)},this.connectCallback=i},t.prototype.disconnect=function(e){return this._transmit("DISCONNECT"),this.ws.close(),this.connected=!1,this.pinger&&typeof window!="undefined"&&window!==null&&window.clearInterval(this.pinger),typeof e=="function"?e():void 0},t.prototype.send=function(e,t,n){return t==null&&(t={}),n==null&&(n=""),t.destination=e,this._transmit("SEND",t,n)},t.prototype.subscribe=function(e,t,n){var r;return n==null&&(n={}),typeof n.id=="undefined"||n.id.length===0?(r="sub-"+this.counter++,n.id=r):r=n.id,n.destination=e,this.subscriptions[r]=t,this._transmit("SUBSCRIBE",n),r},t.prototype.unsubscribe=function(e,t){return t==null&&(t={}),t.id=e,delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",t)},t.prototype.begin=function(e,t){return t==null&&(t={}),t.transaction=e,this._transmit("BEGIN",t)},t.prototype.commit=function(e,t){return t==null&&(t={}),t.transaction=e,this._transmit("COMMIT",t)},t.prototype.abort=function(e,t){return t==null&&(t={}),t.transaction=e,this._transmit("ABORT",t)},t.prototype.ack=function(e,t){return t==null&&(t={}),t["message-id"]=e,this._transmit("ACK",t)},t}(),typeof window!="undefined"&&window!==null?window.Stomp=n:(exports.Stomp=n,n.WebSocketClass=require("./test/server.mock.js").StompServerMock)}).call(this);